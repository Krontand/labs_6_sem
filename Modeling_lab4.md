# Лабораторная работа №4 по моделированию
## Постановка задачи

#### Слава Ктулху, линеаризацию можно не использовать, что весьма ощутимо облегчает лабу.

**Везде в руководстве под переменной `y` подразумевается температура `T`.**

Эта лабораторная является усложненным вариантом третьей лабораторной. В 3-ей необходимо было решить так называемую стационарную задачу - т.е. найти уже установившуюся температуру на всей длине стержня. В этой работе появляется зависимость от времени - необходимо как бы проследить весь процесс нагрева стержня. На выходе нужно построить график с изолиниями: каждая линия соответствует нагреву стержня в определенный момент времени.

![](/assets/l4_example.png)

_На графике не надо строить все шаги, их может быть в районе тысячи, а то и двух._

_Решение должно сходиться к стационарной задаче (той, что в предыдущей работе). На картинке выше оно выделено зеленым цветом. Для его получения можно, например, использовать тот же самый код, но сделать теплоемкость равной нулю._

Исходные данные:
* l = 10см (Длина стержня)
* R = 0.5см (Радиус стержня)
* Tenv = 300К (Температура окружающей среды)
* F0 = 100 Вт / (см^2 * К) (Плотность теплового потока)
* α0 = 1e-2  Вт / (см^2 * К) (Коэффициент теплоотдачи в начале стержня)
* αN = 0.9e-2  Вт / (см^2 * К) (Коэффициент теплоотдачи в конце стержня)

Также необходимо самостоятельно найти зависимости объемной теплоемкости C(T) и коэффициента теплопроводности k(T) от температуры для какого-нибудь материала. Я брал данные для вольфрама (ниже будет табличка)

_Замечание. Для коэффициента теплопроводности может использоваться как `k`, так и `λ`, я использую `k`, потому что мне так проще._

Исходное уравнение выглядит следующим образом:

![](http://latex.codecogs.com/gif.latex?C(T)\frac{\partial&space;T}{\partial&space;t}=\frac{\partial&space;}{\partial&space;x}\left&space;(&space;k(T)\frac{\partial&space;T}{\partial&space;x}&space;\right&space;)-\frac{2\alpha(x)}{R}T(x)&plus;\frac{2\alpha(x)}{R}*T_{env})

Исходные граничные условия не изменились:

![](/assets/2.png)

![](/assets/3.png)

## Концепция решения

Функция, производящая вычисления, будет иметь два вложенных цикла. Внешний цикл - по времени, итогом каждой его итерации будет массив значений T(x) в данный момент времени. Во внутреннем цикле методом простых итераций будет находиться этот самый массив T(x). 
 * Внешний цикл
 * * Внутренний цикл 
 * * Вычисляем граничные условия
 * * Вычисляем массивы коэффициентов для прогонки
 * * Выполняем прогонку и получаем новый массив `T(x)`
 * * Выход из цикла, если `max|T(x) - T_предыдущее(x)|/T(x) < ε` - т.е. находим максимально изменившийся элемент, и смотрим, насколько велико это изменение
 * Добавляем в решение очередной массив `T(x)`
 * Выход из цикла, если `max|T(x) - T_предыдущее(x)|/T(x) < ε` - т.е. завершаем вычисления, если нагрев настолько замедлился, что максимальное изменение температуры за шаг времени достаточно мало
 
 ## Теплоемкость и теплопроводность
 
 Необходимо выбрать какой-нибудь реальный материал и использовать данные для него.
 В отличие от 3 лабораторной, здесь коэффициент теплопроводности `k` зависит от температуры, а не напрямую от координаты. Работа предполагает два варианта задания теплопроводности:
 
 В виде функции: ![](http://latex.codecogs.com/gif.latex?k(T)&space;=&space;k_0*\left(\frac{T}{\theta}\right)^{m};\theta=300K). Коэффициенты `k0` и `m` надо как-нибудь подобрать, чтобы они соответствовали выбранному материалу. По мне это все отдает шаманством, и я это не использовал.
 
 В виде таблицы: при некотором желании несложно нагуглить таблицы теплопроводности и теплоемкости для нужного материала. Я выбрал вольфрам; другой неплохой вариант - сапфировый стержень, но найти данные для него - задача сомнительной выполнимости.
 
 _Важно: нужна именно объемная теплоемкость. В таблицах в основном дается массовая теплоемкость с размерностью Дж/(кг*К). Соответственно для получения объемной теплоемкости надо массовую теплоемкость умножить на плотность. Также важно не перепутать размерности и получить теплоемкость на кубический сантиметр, а не кубический метр (чтобы сошлись все размерности в уравнении)._
 
 Соответсвенно, когда нам надо посчитать коэффициент для определенной температуры, мы просто интерполируем данные из таблицы, как делали это во второй лабораторной.

_Данные для вольфрама._

|T, K |C, Дж/(см^3*К)|k, Вт/(см*К)|
|-----|------|-----|
|300  |2.544 |0.163|
|400  |2.615 |0.156|
|500  |2.656 |0.146|
|600  |2.689 |0.137|
|700  |2.717 |0.130|
|800  |2.748 |0.124|
|900  |2.783 |0.120|
|1000 |2.817 |0.117|
|1200 |2.893 |0.114|
|1400 |2.977 |0.111|
|1600 |3.070 |0.110|
|1800 |3.124 |0.109|
|2000 |3.270 |0.108|
|2200 |3.381 |0.107|
|2400 |3.502 |0.107|
|2600 |3.640 |0.107|
|2800 |3.792 |0.109|
|3000 |3.968 |0.108|
 
 ## Разностная схема и коэффициенты для прогонки
 
 _Замечание. Галочкой сверху обозначается, что переменная берется в следующий момент времени, соответственно, без галочки - в предыдущий момент времени:_
 ![](http://latex.codecogs.com/gif.latex?y_n&space;=&space;y(x_n,&space;t_m);\widehat{y}_n&space;=&space;y(x_n,&space;t_{m&plus;1}))
 
 Как и в предыдущей работе, для получения разностной схемы, используем интегро-интерполяционный метод, однако здесь интегрируем на ячейке по двум переменным: по координате `x` и по времени `t`.
 
 ![](http://latex.codecogs.com/gif.latex?\int_{x_{n-1/2}}^{x_{n&plus;1/2}}dx\int_{t_m}^{t_{m&plus;1}}C(T)\frac{\partial&space;T}{\partial&space;t}dt=\int_{t_m}^{t_{m&plus;1}}dt\int_{x_{n-1/2}}^{x_{n&plus;1/2}}\left&space;(\frac{\partial&space;}{\partial&space;x}\left&space;(&space;k(T)\frac{\partial&space;T}{\partial&space;x}&space;\right&space;)-\frac{2\alpha(x)}{R}T(x)&plus;\frac{2\alpha(x)}{R}*T_{env}\right&space;))
 
Для начала левую часть проинтегрируем по времени (обратите внимание, что `dt` там сокращаются). Правую часть проинтегрируем по `x` - фактически, мы уже сделали это в 3 лабораторной, поэтому воспользуемся результатами оттуда:

![](http://latex.codecogs.com/gif.latex?\int_{x_{n-1/2}}^{x_{n&plus;1/2}}\widehat{C}(\widehat{y}-y)dx=\int_{t_m}^{t_{m&plus;1}}\left(X_{n-1/2}\frac{y_{n-1}-y_n}{h}-X_{n&plus;1/2}\frac{y_n-y_{n&plus;1}}{h}-p_nhy_n&plus;f_nh\right)dt)

Теперь проинтегрируем по оставшимся переменным. Слева используем метод средних прямоугольников. Справа возьмем значение не в середине интервала, а в следующий момент времени `t_m+1`. 
_Получится так называемая **чисто неявная схема** - ведь нам пока неизвестны эти самые значения в следующий момент времени. Для их нахождения мы и используем метод итераций во внутреннем цикле. Если бы мы взяли значения в момент `t_m`, то есть в предыдущий момент времени, то получилась бы **чисто явная схема**. Также возможны смешанные варианты, например, среднее от значений в предыдущий и следующий момент времени._

![](http://latex.codecogs.com/gif.latex?\widehat{C}_n(\widehat{y}_n-y_n)h=\tau\widehat{X}_{n-1/2}\frac{\widehat{y}_{n-1}-\widehat{y}_n}{h}-\tau\widehat{X}_{n&plus;1/2}\frac{\widehat{y}_n-\tau\widehat{y}_{n&plus;1}}{h}-\tau&space;p_nh\widehat{y}_n&plus;\tau&space;f_nh)

_`τ` - шаг по времени._

### Формулы

Преобразуем к виду, подходящему для прогонки, то есть:

![](http://latex.codecogs.com/gif.latex?\widehat{A}_n\widehat{y}_{n-1}-\widehat{B}_n\widehat{y}_n&plus;\widehat{D}_n\widehat{y}_{n&plus;1}=-\widehat{F}_n)

_Буквы немного отличаются от тех, что предыдущей работе, это из-за наличия теплоемкости, которая обозначается буквой `C`. Галочки, как и раньше, обозначают, что переменные берутся в новый момент времени._

![](http://latex.codecogs.com/gif.latex?\widehat{A}_n&space;=&space;\tau\frac{\widehat{X}_{n-1/2}}{h})

![](http://latex.codecogs.com/gif.latex?\widehat{D}_n&space;=&space;\tau\frac{\widehat{X}_{n&plus;1/2}}{h})

![](http://latex.codecogs.com/gif.latex?\widehat{B}_n=\widehat{A}_n&plus;\widehat{D}_n&plus;p_nh\tau&plus;\widehat{C}_nh)

![](http://latex.codecogs.com/gif.latex?\widehat{F}_n=\widehat{C}_nhy_n&plus;f_nh\tau)

..где:

![](http://latex.codecogs.com/gif.latex?\widehat{X}_{n-1/2}=\frac{\widehat{k}_{n-1}&plus;\widehat{k}_n}{2};\widehat{X}_{n&plus;1/2}=\frac{\widehat{k}_n&plus;\widehat{k}_{n&plus;1}}{2})

![](http://latex.codecogs.com/gif.latex?\widehat{k}_n=k(\widehat{T}_n);\widehat{T}_n=\widehat{T}(x_n))

![](http://latex.codecogs.com/gif.latex?p_n=\frac{2\alpha(x_n)}{R})

![](http://latex.codecogs.com/gif.latex?f_n=\frac{2\alpha(x_n)}{R}T_{env})

## Граничные условия

Несмотря на то, что исходные краевые условия не изменились, изменившееся условие даст новый вид разностного аналога краевых условий.

Получаем же их тем же методом, что и в прошлой работе: интегрируем на половине первого и на половине последнего интервалов (а также на ячейке по времени):

![](http://latex.codecogs.com/gif.latex?\int_{x_0}^{x_{1/2}}dx\int_{t_m}^{t_{m&plus;1}}C(T)\frac{\partial&space;T}{\partial&space;t}dt=\int_{t_m}^{t_{m&plus;1}}dt\int_{x_0}^{x_{1/2}}\left(\frac{\partial}{\partial&space;x}\left(k(T)\frac{\partial&space;T}{\partial&space;x}\right)-\frac{2\alpha(x)}{R}T(x)&plus;\frac{2\alpha(x)}{R}*T_{env}\right&space;))

Для правой части можно воспользоваться уже выведенным условием в третьей работе, а для интегрирования по времени опять возьмем значение в новый момент времени.

Левую же часть проинтегрируем в два этапа - сначала по времени:

![](http://latex.codecogs.com/gif.latex?\int_{x_0}^{x_{1/2}}dx\int_{t_m}^{t_{m&plus;1}}C(T)\frac{\partial&space;T}{\partial&space;t}dt=\int_{x_0}^{x_{1/2}}\widehat{C}(\widehat{y}-y)dx)

А затем по иксу, используя метод трапеций:

![](http://latex.codecogs.com/gif.latex?\int_{x_0}^{x_{1/2}}\widehat{C}(\widehat{y}-y)dx=\frac{h}{4}(\widehat{C}_{1/2}(\widehat{T}_{1/2}-T_{1/2})&plus;\widehat{C}_0(\widehat{T}_0-T_0)))

Я опущу полный процесс вывода (потому что сам его не делал, просто добавил нужные множители и слагаемые в уже имеющиеся формулы для краевых условий).

Итак, в итоге имеем краевое условие вида

![](http://latex.codecogs.com/gif.latex?\widehat{K}_0\widehat{y}_0&plus;\widehat{M}_0\widehat{y}_1=\widehat{P}_0)

С коэффициентами:

![](http://latex.codecogs.com/gif.latex?\widehat{K}_0=\tau(\frac{\widehat{X}_{1/2}}{h}&plus;\frac{h}{8}p_{1/2}&plus;\frac{h}{4}p_0)&plus;\frac{h}{4}\widehat{C}_0&plus;\frac{h}{8}\widehat{C}_{1/2})

![](http://latex.codecogs.com/gif.latex?\widehat{M}_0=\tau(\frac{h}{8}p_{1/2}-\frac{\widehat{X}_{1/2}}{h})&plus;\frac{h}{8}\widehat{C}_{1/2})

![](http://latex.codecogs.com/gif.latex?\widehat{P}_0=\tau&space;F_0&plus;\tau&space;\frac{h}{8}(3f_0&plus;f_1)&plus;\frac{h}{4}\widehat{C}_0y_0&plus;\frac{h}{8}\widehat{C}_{1/2}(y_0&plus;y_1))

_NB! В `P0` используется `y0` и `y1` без галочки, то есть в **предыдущий** момент времени. С точки зрения программы - значение из массива с предыдущей итерации внешнего цикла._

С правой частью все аналогично, только интегрируем на половине последнего шага.

![](http://latex.codecogs.com/gif.latex?\widehat{K}_N=-\tau\left(\frac{\widehat{X}_{N-1/2}}{h}&plus;\alpha_N&plus;\frac{h}{4}p_N&plus;\frac{h}{8}p_{N-1/2}\right)&space;&plus;\frac{h}{4}\widehat{C}_N&plus;\frac{h}{8}\widehat{C}_{N-1/2})

![](http://latex.codecogs.com/gif.latex?\widehat{M}_N=\tau\left(\frac{\widehat{X}_{N-1/2}}{h}-\frac{h}{8}p_{N-1/2}\right)&space;&plus;\frac{h}{8}\widehat{C}_{N-1/2})

![](http://latex.codecogs.com/gif.latex?\widehat{P}_N=-\alpha_NT_{env}\tau-\tau\frac{h}{8}(3f_N&plus;f_{N-1})&plus;\frac{h}{4}\widehat{C}_Ny_N&plus;\frac{h}{8}\widehat{C}_{N-1/2}(y_N&plus;y_{N-1}))

## Итерации

Для получения нагрева в следующий момент времени необходимо использовать метод итераций:

![](http://latex.codecogs.com/gif.latex?\widehat{A}_n^{(s-1)}\widehat{y}_{n-1}^{(s)}-\widehat{B}_n^{(s-1)}\widehat{y}_n^{(s)}&plus;\widehat{D}_n^{(s-1)}\widehat{y}_{n&plus;1}^{(s)}=-\widehat{F}^{(s-1)}_n)

То есть вычислять коэффициенты для прогонки, используя полученное на предыдущем шаге приближение, чтобы получить новое решение. Повторять, пока максимальное изменение не станет достаточно мало.
